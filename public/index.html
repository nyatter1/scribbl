<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatApp - Virtual Lobby</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=JetBrains+Mono:wght@400;700&display=swap');
        
        body { font-family: 'Inter', sans-serif; overflow: hidden; background-color: #020617; }
        
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }

        .message-anim { animation: slideIn 0.3s ease-out forwards; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Rank Styles */
        .rank-badge {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 9px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .rank-Owner { background: #f59e0b; color: #451a03; }
        .rank-Developer { background: #ef4444; color: #450a0a; }
        .rank-Admin, .rank-Head-Admin { background: #8b5cf6; color: #2e1065; }
        .rank-Moderator, .rank-Senior-Mod { background: #3b82f6; color: #172554; }
        .rank-Member { background: #475569; color: #f8fafc; }
        .rank-BOT { background: #10b981; color: #064e3b; }
        
        /* Profile Modal UI */
        #profile-modal {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
        }

        .profile-card {
            background: #0f172a;
            border: 1px solid #1e293b;
            width: 360px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .profile-banner {
            height: 100px;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            position: relative;
        }

        .profile-avatar-wrapper {
            margin-top: -50px;
            position: relative;
            z-index: 10;
        }

        /* Console Styles */
        #terminal-overlay {
            background: rgba(2, 6, 23, 0.98);
            backdrop-filter: blur(20px);
            font-family: 'JetBrains Mono', monospace;
        }
    </style>
</head>
<body class="text-slate-200 h-screen flex flex-col">

    <div id="main-content-wrapper" class="flex-1 flex flex-col overflow-hidden">
        <!-- Header -->
        <header class="h-16 border-b border-slate-800 flex items-center justify-between px-6 bg-slate-900/50">
            <div class="flex items-center gap-4">
                <h1 class="text-xl font-black italic tracking-tighter text-white uppercase">ChatApp</h1>
                <div class="h-4 w-px bg-slate-800"></div>
                <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Live Lobby</p>
            </div>
                    
            <div class="flex items-center gap-4 relative">
                <div onclick="toggleDropdown(event)" class="flex items-center gap-3 cursor-pointer p-1 pr-3 hover:bg-slate-800 rounded-full transition border border-transparent">
                    <img id="header-pfp" src="" class="w-8 h-8 rounded-full bg-slate-800 border border-slate-700 object-cover">
                    <div class="flex flex-col">
                        <span id="header-username" class="text-xs font-bold text-white">@username</span>
                        <span id="header-rank" class="text-[8px] text-indigo-400 uppercase font-black tracking-tighter">Rank</span>
                    </div>
                </div>

                <div id="header-dropdown" class="hidden absolute right-0 top-full mt-2 w-56 bg-slate-900 border border-slate-800 rounded-2xl shadow-2xl py-2 z-50">
                    <button onclick="viewProfile(currentUser.username)" class="w-full flex items-center gap-3 px-4 py-3 hover:bg-white/5 text-xs font-bold text-slate-300 transition text-left">
                        View Profile
                    </button>
                    <button onclick="location.reload()" class="w-full flex items-center gap-3 px-4 py-3 hover:bg-red-500/10 text-xs font-bold text-red-400 transition text-left border-t border-slate-800">
                        Logout
                    </button>
                </div>
            </div>
        </header>

        <div class="flex-1 flex overflow-hidden">
            <!-- Sidebar -->
            <aside class="w-64 bg-slate-900/30 border-r border-slate-800 flex flex-col hidden md:flex">
                <div class="p-3 space-y-6 overflow-y-auto custom-scrollbar">
                    <div>
                        <div class="px-2 mb-3 flex justify-between items-center">
                            <span class="text-[10px] font-black uppercase text-indigo-400 tracking-widest">Online</span>
                            <span id="online-count" class="text-[10px] bg-indigo-500/20 text-indigo-400 px-2 py-0.5 rounded-full font-bold">0</span>
                        </div>
                        <div id="online-users" class="space-y-1"></div>
                    </div>
                </div>
            </aside>

            <!-- Chat Area -->
            <main class="flex-1 flex flex-col bg-slate-950/50">
                <div id="chat-messages" class="flex-grow overflow-y-auto p-6 space-y-6 custom-scrollbar flex flex-col"></div>
                <div class="p-4 bg-slate-900/50 border-t border-slate-800">
                    <div class="max-w-4xl mx-auto flex gap-3">
                        <input type="text" id="message-input" class="flex-1 bg-slate-900 border border-slate-800 rounded-2xl px-5 py-4 text-sm text-white focus:outline-none focus:border-indigo-500" placeholder="Type a message...">
                        <button onclick="sendMessage()" class="bg-indigo-600 hover:bg-indigo-500 text-white px-6 rounded-2xl transition font-bold text-xs uppercase tracking-widest">Send</button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- User Profile Modal -->
    <div id="profile-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4">
        <div class="profile-card rounded-[2rem] overflow-hidden relative">
            <!-- Banner -->
            <div id="modal-banner" class="profile-banner">
                <button onclick="closeProfile()" class="absolute top-4 right-4 text-white/50 hover:text-white transition bg-black/20 p-1.5 rounded-full">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                </button>
            </div>

            <!-- Profile Info -->
            <div class="px-8 pb-6 flex flex-col items-center">
                <div class="profile-avatar-wrapper">
                    <img id="modal-pfp" src="" class="w-24 h-24 rounded-full border-[6px] border-[#0f172a] object-cover bg-slate-800">
                    <div class="absolute bottom-0 right-0 bg-yellow-500 text-slate-900 w-8 h-8 rounded-full flex items-center justify-center border-4 border-[#0f172a]">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                    </div>
                </div>

                <div class="text-center mt-3">
                    <h3 id="modal-username" class="text-xl font-black text-white uppercase">@username</h3>
                    <div id="modal-rank-container" class="mt-1">
                        <span id="modal-rank" class="rank-badge">RANK</span>
                    </div>
                </div>

                <div class="w-full mt-6 grid grid-cols-2 gap-4">
                    <div class="flex flex-col items-center p-3 bg-slate-800/40 rounded-2xl">
                        <span class="text-[9px] uppercase font-black text-slate-500 tracking-widest">Joined</span>
                        <span id="modal-joined" class="text-xs font-bold text-slate-300">Jan 2024</span>
                    </div>
                    <div class="flex flex-col items-center p-3 bg-slate-800/40 rounded-2xl">
                        <span class="text-[9px] uppercase font-black text-slate-500 tracking-widest">Last Online</span>
                        <span id="modal-last-seen" class="text-xs font-bold text-indigo-400">Online Now</span>
                    </div>
                </div>

                <div class="w-full mt-4 grid grid-cols-3 gap-2">
                    <div class="flex flex-col items-center py-4 bg-slate-900 border border-slate-800/50 rounded-2xl">
                        <span class="text-[8px] uppercase font-black text-slate-500 tracking-tighter">Mutes</span>
                        <span id="modal-mutes" class="text-sm font-black text-white">0</span>
                    </div>
                    <div class="flex flex-col items-center py-4 bg-slate-900 border border-slate-800/50 rounded-2xl">
                        <span class="text-[8px] uppercase font-black text-slate-500 tracking-tighter">Likes</span>
                        <span id="modal-likes" class="text-sm font-black text-indigo-400">0</span>
                    </div>
                    <div class="flex flex-col items-center py-4 bg-slate-900 border border-slate-800/50 rounded-2xl">
                        <span class="text-[8px] uppercase font-black text-slate-500 tracking-tighter">Mutuals</span>
                        <span id="modal-mutuals" class="text-sm font-black text-white">0</span>
                    </div>
                </div>

                <button id="like-btn" onclick="likeUser()" class="w-full mt-6 bg-indigo-600 hover:bg-indigo-500 text-white py-3 rounded-2xl font-black text-[10px] uppercase tracking-[0.2em] transition-all shadow-lg shadow-indigo-900/20">
                    Send Appreciation
                </button>
            </div>
        </div>
    </div>

    <!-- Staff Terminal -->
    <div id="terminal-overlay" class="hidden fixed inset-0 z-[200] flex flex-col p-6">
        <div class="flex items-center justify-between mb-4 border-b border-emerald-500/20 pb-2">
            <span class="text-[10px] font-bold uppercase tracking-widest text-emerald-500">Root Access Terminal</span>
            <button onclick="closeConsole()" class="text-[10px] font-black text-emerald-500 hover:text-white uppercase">[Exit]</button>
        </div>
        <div id="terminal-output" class="flex-1 overflow-y-auto text-xs space-y-1 text-emerald-500 font-mono"></div>
        <div class="flex items-center gap-2 border-t border-emerald-500/20 pt-4">
            <span class="text-emerald-500 font-bold">$</span>
            <input type="text" id="terminal-input" class="bg-transparent border-none outline-none text-emerald-400 w-full text-xs font-mono" placeholder="awaiting command..." autofocus>
        </div>
    </div>

    <script>
        let currentUser = {
            username: "User_" + Math.floor(Math.random() * 9999),
            role: "Member",
            pfp: "",
            mutes: 0,
            likes: 0,
            joined: "Oct 2025",
            lastSeen: Date.now(),
            mutuals: 0,
            banner: "linear-gradient(135deg, #4338ca 0%, #1e1b4b 100%)"
        };

        let liveUsers = [
            { username: "System", role: "Developer", pfp: "https://ui-avatars.com/api/?name=S&background=ef4444", mutes: 0, likes: 999, joined: "Jan 2023", lastSeen: Date.now(), mutuals: 12, banner: "#ef4444" },
            { username: "Nexus_Bot", role: "BOT", pfp: "https://api.dicebear.com/7.x/bottts/svg?seed=Nexus", mutes: 0, likes: 42, joined: "Feb 2024", lastSeen: Date.now(), mutuals: 0, banner: "#10b981" }
        ];

        // Offline Users for "Last Online" demo
        let allRegisteredUsers = [
            ...liveUsers,
            { username: "OldFriend", role: "Member", pfp: "", mutes: 2, likes: 5, joined: "Dec 2023", lastSeen: Date.now() - 3600000 * 5, mutuals: 1, banner: "#334155" }
        ];

        window.onload = () => {
            const saved = localStorage.getItem('chat_user_v2');
            if (saved) currentUser = JSON.parse(saved);
            else localStorage.setItem('chat_user_v2', JSON.stringify(currentUser));
            
            if (!liveUsers.find(u => u.username === currentUser.username)) liveUsers.push(currentUser);
            if (!allRegisteredUsers.find(u => u.username === currentUser.username)) allRegisteredUsers.push(currentUser);

            refreshUI();
            
            document.getElementById('message-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
            document.getElementById('terminal-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') executeConsoleCommand();
            });
        };

        function refreshUI() {
            document.getElementById('header-username').innerText = `@${currentUser.username}`;
            document.getElementById('header-rank').innerText = currentUser.role;
            document.getElementById('header-pfp').src = currentUser.pfp || `https://ui-avatars.com/api/?name=${currentUser.username}&background=random`;
            renderUserList();
        }

        function toggleDropdown(e) {
            e.stopPropagation();
            document.getElementById('header-dropdown').classList.toggle('hidden');
        }

        window.onclick = () => document.getElementById('header-dropdown').classList.add('hidden');

        function viewProfile(username) {
            const user = allRegisteredUsers.find(u => u.username === username);
            if (!user) return;
            
            const isOnline = liveUsers.some(lu => lu.username === username);
            const modal = document.getElementById('profile-modal');
            
            document.getElementById('modal-username').innerText = `@${user.username}`;
            document.getElementById('modal-pfp').src = user.pfp || `https://ui-avatars.com/api/?name=${user.username}&background=random`;
            document.getElementById('modal-mutes').innerText = user.mutes || 0;
            document.getElementById('modal-likes').innerText = user.likes || 0;
            document.getElementById('modal-mutuals').innerText = user.mutuals || 0;
            document.getElementById('modal-joined').innerText = user.joined;
            document.getElementById('modal-banner').style.background = user.banner || '#1e293b';

            // Last Seen Logic
            const seenEl = document.getElementById('modal-last-seen');
            if (isOnline) {
                seenEl.innerText = "Online Now";
                seenEl.className = "text-xs font-bold text-green-400";
            } else {
                seenEl.innerText = formatTimeAgo(user.lastSeen);
                seenEl.className = "text-xs font-bold text-slate-400";
            }
            
            const rankBadge = document.getElementById('modal-rank');
            rankBadge.innerText = user.role;
            rankBadge.className = `rank-badge rank-${user.role.replace(/ /g, '-')}`;
            
            document.getElementById('like-btn').style.display = user.username === currentUser.username ? 'none' : 'block';
            modal.classList.remove('hidden');
        }

        function formatTimeAgo(timestamp) {
            const seconds = Math.floor((Date.now() - timestamp) / 1000);
            if (seconds < 60) return "Just now";
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes}m ago`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours}h ago`;
            return "Days ago";
        }

        function likeUser() {
            const username = document.getElementById('modal-username').innerText.replace('@', '');
            const user = allRegisteredUsers.find(u => u.username === username);
            if (user) {
                user.likes++;
                document.getElementById('modal-likes').innerText = user.likes;
            }
        }

        function closeProfile() {
            document.getElementById('profile-modal').classList.add('hidden');
        }

        function sendMessage() {
            const input = document.getElementById('message-input');
            const text = input.value.trim();
            if (!text) return;

            if (text.startsWith("/c") && (currentUser.role === 'Owner' || currentUser.role === 'Developer')) {
                openConsole();
                input.value = "";
                return;
            }

            const container = document.getElementById('chat-messages');
            const rankClass = `rank-${currentUser.role.replace(/ /g, '-')}`;
            
            const msgHtml = `
                <div class="flex flex-row-reverse items-start gap-4 message-anim">
                    <img onclick="viewProfile('${currentUser.username}')" src="${currentUser.pfp || `https://ui-avatars.com/api/?name=${currentUser.username}`}" class="w-10 h-10 rounded-2xl cursor-pointer hover:ring-2 ring-indigo-500 transition-all">
                    <div class="max-w-[70%] items-end flex flex-col gap-1">
                        <div class="flex items-center gap-2 flex-row-reverse">
                            <span class="text-[10px] font-black uppercase tracking-widest text-slate-500">${currentUser.username}</span>
                            <span class="rank-badge ${rankClass}">${currentUser.role}</span>
                        </div>
                        <div class="p-4 rounded-3xl bg-indigo-600 text-white shadow-xl">
                            <p class="text-sm">${text}</p>
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', msgHtml);
            input.value = "";
            container.scrollTop = container.scrollHeight;
        }

        function renderUserList() {
            const list = document.getElementById('online-users');
            document.getElementById('online-count').innerText = liveUsers.length;
            list.innerHTML = liveUsers.map(u => {
                const rankClass = `rank-${u.role.replace(/ /g, '-')}`;
                return `
                    <div onclick="viewProfile('${u.username}')" class="flex items-center gap-3 p-2 rounded-xl transition cursor-pointer hover:bg-slate-800 group">
                        <div class="relative">
                            <img src="${u.pfp || `https://ui-avatars.com/api/?name=${u.username}`}" class="w-8 h-8 rounded-lg object-cover">
                            <div class="absolute -bottom-1 -right-1 w-2.5 h-2.5 bg-green-500 border-2 border-[#020617] rounded-full"></div>
                        </div>
                        <div class="overflow-hidden">
                            <p class="text-xs font-bold text-slate-300 truncate">${u.username}</p>
                            <span class="rank-badge ${rankClass}" style="zoom: 0.8">${u.role}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function openConsole() {
            document.getElementById('terminal-overlay').classList.remove('hidden');
            document.getElementById('terminal-input').focus();
        }
        function closeConsole() { document.getElementById('terminal-overlay').classList.add('hidden'); }

        function executeConsoleCommand() {
            const input = document.getElementById('terminal-input');
            const output = document.getElementById('terminal-output');
            const fullCmd = input.value.trim();
            if (!fullCmd) return;
            const args = fullCmd.split(" ");
            const cmd = args[0].toLowerCase();
            const log = (text) => { output.innerHTML += `<div>> ${text}</div>`; output.scrollTop = output.scrollHeight; };

            if (cmd === 'rank' && args.length >= 3) {
                const target = args[1].replace('@', '');
                const role = args[2];
                let user = allRegisteredUsers.find(u => u.username.toLowerCase() === target.toLowerCase());
                if (user) {
                    user.role = role;
                    if (user.username === currentUser.username) {
                        currentUser.role = role;
                        localStorage.setItem('chat_user_v2', JSON.stringify(currentUser));
                    }
                    log(`Updated ${target} to ${role}`);
                    refreshUI();
                }
            } else if (cmd === 'mute' && args.length >= 2) {
                const target = args[1].replace('@', '');
                let user = allRegisteredUsers.find(u => u.username.toLowerCase() === target.toLowerCase());
                if (user) {
                    user.mutes++;
                    log(`Muted ${target}. Total: ${user.mutes}`);
                }
            } else {
                log("Unknown command sequence.");
            }
            input.value = "";
        }
    </script>
</body>
</html>
